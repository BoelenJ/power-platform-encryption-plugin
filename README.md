# Encryption plugin for the Power Platform

This plugin uses the default System.Security.Cryptography package from C# to encrypt and decrypt a string using AES encryption. This repository contains both the source code as well as a sample power platform solution to test out this plugin. 

## Implementation of AES

AES requires both a secret key and ideally an initialization value (IV) to make it secure. The IV itself is not necessarily a secret and can be shared without security risk, as it is mainly intended to introduce some randomization, basically meaning that if you encrypt a string with the same secret key twice,the encrypted results will differ due to the IV.

To keep this randomization in place, it is not feasible to supply your own IV each time you do the encryption, as this means you also need to share it with other services which will do the decryption. So to solve that, my approach implements a common way of dealing with the IV, which works as follows:

- The plugin expects only a secret key.
- The IV is generated by the plugin itself and is pre-pended to the encrypted string, this way the IV itself will be passed along with the encrypted string.
- For decryption, the code needs to split the encrypted string into two, the first part is the IV (with a fixed length) and the second is the actual string. After doing so, the encryption can be done using the secret key.

See the code for the exact implementation.

## Set-up

If you want to build your own version based on this, you can use the Encrypt and Decrypt classes as starting point. Then, you would need to follow these steps to add it to you environment:

- Build the solution using Visual Studio.
- Register the .sln file using the plugin registration tool.
- Create a new custom API using the plugin registration tool, which should use the assembly you just uploaded and should have input and output parameters that match the values you used in the code.
